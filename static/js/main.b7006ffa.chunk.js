(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{110:function(e,t,n){"use strict";n.r(t);var a=n(0),r=n.n(a),o=n(30),i=n.n(o),s=n(1),l=n(2),u=n(14),c=n(3),d=n(4),h=(n(73),n(51)),m=n(22),p=n(11),g=function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"Page under construction --- our ingeneous engineers are working on it"),r.a.createElement("img",{title:"Our oompa loompa is processing. Please wait.",src:n(42),alt:"loading...",align:"middle"}))};var f=function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"Page under construction --- our ingeneous engineers are working on it"),r.a.createElement("img",{title:"Our oompa loompa is processing. Please wait.",src:n(42),alt:"loading...",align:"middle"}))},v=n(12),b=n(26),E=n(10),y=n(28),w=n(113),C=n(5);var k=function(e){var t=Object(a.useState)({height:.8*window.innerHeight}),n=Object(v.a)(t,2),o=n[0],i=n[1],s=r.a.useRef([]);if(Object(a.useEffect)(function(){function e(){i({height:.8*window.innerHeight})}return window.addEventListener("resize",e),e(),function(){return window.removeEventListener("resize",e)}},[]),0===e.patientsComputed.length)return r.a.createElement("div",null,"You need to compute some results before being able to display.");var l=function(e){for(var t=Object(a.useRef)(),n=Object(a.useRef)(),o=new C.Geometry,i=0;i<e.rv[7].V.length;i++)o.vertices.push(Object(b.a)(C.Vector3,Object(E.a)(e.rv[7].Varray[i])));for(var s=0;s<e.rv[7].E.length;s++){o.faces.push(Object(b.a)(C.Face3,Object(E.a)(e.rv[7].E[s])));for(var l=0;l<3;l++){var u,c=e.rv[7].E[s][l];u=e.rv[7].dA[c]<e.rv[7].dP[c]&&e.rv[7].dA[c]<e.rv[7].dT[c]?new C.Color(1017121):e.rv[7].dT[c]<e.rv[7].dP[c]?new C.Color(1000069):new C.Color(8722447),o.faces[s].vertexColors[l]=u}}o.computeBoundingSphere(),o.center(),e.radius.current.radius=o.boundingSphere.radius;var d=new C.MeshStandardMaterial({vertexColors:C.VertexColors}),h=new C.WireframeGeometry(o),m=new C.LineBasicMaterial({color:0,linewidth:5,polygonOffset:!0,polygonOffsetFactor:2,polygonOffsetUnits:1});return o.computeFaceNormals(),r.a.createElement("group",null,r.a.createElement("mesh",{ref:t,geometry:o,material:d}),r.a.createElement("lineSegments",{ref:n,geometry:h,material:m}))}({rv:e.patientsComputed[0],radius:s});return r.a.createElement("div",{align:"middle"},r.a.createElement(y.a,{style:{height:o.height,width:"95%",textAlign:"center",background:"#D3D3D3"},camera:{position:[0,0,-3*s.current.radius],far:5*s.current.radius}},r.a.createElement("ambientLight",null),r.a.createElement(a.Suspense,{fallback:null},l),r.a.createElement(w.a,{rotateSpeed:4})))},O=function(){return r.a.createElement("div",null,r.a.createElement("h2",null,"Page under construction --- our ingeneous engineers are working on it"),r.a.createElement("img",{title:"Our oompa loompa is processing. Please wait.",src:n(42),alt:"loading...",class:"center"}))},j=(n(41),n(65)),x=function(e){return r.a.createElement(j.slide,e,r.a.createElement(m.b,{to:"/"},"Home"),r.a.createElement(m.b,{to:"/computation"},"Computation"),r.a.createElement(m.b,{to:"/visualisation"},"Visualisation"),r.a.createElement(m.b,{to:"/settings"},"Settings"),r.a.createElement(m.b,{to:"/about"},"About"))},V=function(e){Object(c.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(s.a)(this,n),(a=t.call(this,e)).state={patientResults:[],mode:"local"},a.addNewResult=a.addNewResult.bind(Object(u.a)(a)),a.getComputedData=a.getComputedData.bind(Object(u.a)(a)),a}return Object(l.a)(n,[{key:"addNewResult",value:function(e,t,n,a,r,o){var i;i=o?function(e,t){return t}:function(e,t){return 100*(e-t)/e};var s=this.state.patientResults;s.push([e,t[0],t[1],t[2],i(t[0],n[0]),i(t[1],n[1]),i(t[2],n[2]),a,r]),this.setState({patientResults:s})}},{key:"getComputedData",value:function(){return this.state.patientResults}},{key:"render",value:function(){return r.a.createElement("div",{className:"App"},r.a.createElement("header",{className:"App-header"},"Right ventricular parcellator."),r.a.createElement("body",null,r.a.createElement(m.a,{basename:"/"},r.a.createElement(x,{pageWrapId:"page-wrap",outerContainerId:"App"}),r.a.createElement("div",{id:"page-wrap"},r.a.createElement(p.c,null,r.a.createElement(p.a,{exact:!0,path:["/","/home"]},r.a.createElement(g,null)),r.a.createElement(p.a,{path:"/computation"},r.a.createElement(h.a,{addNewResult:this.addNewResult,patientsComputed:this.state.patientResults})),r.a.createElement(p.a,{path:"/about"},r.a.createElement(O,null)),r.a.createElement(p.a,{path:"/visualisation"},r.a.createElement(k,{patientsComputed:this.state.patientResults})),r.a.createElement(p.a,{path:"/settings"},r.a.createElement(f,null)))))))}}]),n}(r.a.Component);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(V,null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},29:function(e,t,n){"use strict";var a=n(9),r=n(1),o=n(2);var i=function(){function e(t){Object(r.a)(this,e),this.acumWeights=[],this.totalWeight=0;for(var n=0;n<t.length;n++)this.acumWeights.push(this.totalWeight),this.totalWeight+=t[n]}return Object(o.a)(e,[{key:"getSample",value:function(){return function e(t,n,a,r){var o=Math.floor((a+r)/2);return n[a]<=t&&(a+1==n.length||n[a+1]>=t)?a:n[o]<t?e(t,n,o,r):e(t,n,a,o)}(Math.random()*this.totalWeight,this.acumWeights,0,this.acumWeights.length)}}]),e}(),s=function(){function e(t,n){Object(r.a)(this,e),this.triangles=n,this.coordinates=t,this.mean=new a.d(0,0,0);for(var o=0;o<this.coordinates.length;o++)this.mean.addScaledVector(this.coordinates[o],1/this.coordinates.length);this.absoluteVolumes=[],this.signedVolumes=[];for(var s=0,l=0;l<this.triangles.length;l++){var u=new a.b,c=this.triangles[l];u.set(this.coordinates[c[0]].x-this.mean.x,this.coordinates[c[0]].y-this.mean.y,this.coordinates[c[0]].z-this.mean.z,this.coordinates[c[1]].x-this.mean.x,this.coordinates[c[1]].y-this.mean.y,this.coordinates[c[1]].z-this.mean.z,this.coordinates[c[2]].x-this.mean.x,this.coordinates[c[2]].y-this.mean.y,this.coordinates[c[2]].z-this.mean.z);var d=u.determinant()/6;s+=d,this.absoluteVolumes.push(Math.abs(d)),this.signedVolumes.push(d),this.totalVol=s}console.log(s),this.sampler=new i(this.absoluteVolumes)}return Object(o.a)(e,[{key:"getSample",value:function(){var e=this.sampler.getSample(),t=-Math.log(Math.random()),n=-Math.log(Math.random()),r=-Math.log(Math.random()),o=-Math.log(Math.random()),i=t+n+r+o;t/=i,n/=i,r/=i,o/=i;var s=new a.d(0,0,0),l=this.triangles[e];return s.addScaledVector(this.coordinates[l[0]],t).addScaledVector(this.coordinates[l[1]],n).addScaledVector(this.coordinates[l[2]],r).addScaledVector(this.mean,o),{point:s,sign:Math.sign(this.signedVolumes[e])}}}]),e}(),l=n(60);n.d(t,"c",function(){return p}),n.d(t,"b",function(){return g}),n.d(t,"a",function(){return b});var u=!1,c=n(78),d=n(85);function h(e,t,n){for(var a=[],r=0;r<n;r++)a.push(Math.min(e[r],t[r]));return a}function m(e,t){for(var n=[],a=0;a<t;a++)n.push(e[a]);return n}function p(e){for(var t=e[1],n=e[0],a=[],r=0;r<n.length;r++)a.push([n[r].x,n[r].y,n[r].z]);c(t,a,0);for(var o=[388,389,392,393,144,540,145,538,539,422,423,38,541,49,55,328,329,332,333,87,94,100,101,103,104,105,122,123,126,127],i=[410,411,409,408,53,64,65,66,67,68,69,83,476,477,92,478,480,481,482,483,484,485,486,487,488,489,479],s=c(t,a,906),l=c(t,a,o[0]),u=1;u<o.length;u++)l=h(l,c(t,a,o[u]),n.length);for(var d=c(t,a,i[0]),p=1;p<i.length;p++)d=h(d,c(t,a,i[p]),n.length);var g={};return g.E=t,g.V=n,g.Varray=a,g.dA=m(s,n.length),g.dP=m(d,n.length),g.dT=m(l,n.length),g}function g(e,t){var n={};n.E=e[1],n.V=e[0];for(var a=[],r=0;r<n.V.length;r++)a.push([n.V[r].x,n.V[r].y,n.V[r].z]);return n.Varray=a,n.dA=t.dA,n.dP=t.dP,n.dT=t.dT,n}var f="rbf",v=function(e){return e[0].map(function(t,n){return e.map(function(e){return e[n]})})};function b(e){var t,n=new s(e.V,e.E);t=void 0===e.nsamples?1:e.nsamples;for(var r,o=0,i=0,c=0,h=function(e){for(var t=new a.d(1e3,1e4,1e3),n=new a.d(-1e3,-1e4,-1e3),r=0;r<e.length;r++)t.x>e[r].x&&(t.x=e[r].x),n.x<e[r].x&&(n.x=e[r].x),t.y>e[r].y&&(t.y=e[r].y),n.y<e[r].y&&(n.y=e[r].y),t.z>e[r].z&&(t.z=e[r].z),n.z<e[r].z&&(n.z=e[r].z);return[t,n]}(e.V),m=new l.a(h[0],h[1]),p=0;p<e.V.length;p++)m.insert(e.V[p],p);"rbf"===f&&(r=d(e.Varray,v([e.dA,e.dP,e.dT]),"linear"));for(var g=0;g<t;g++){var b,E,y,w=n.getSample();if("nearest"===f){var C=m.findNearestPoint(w.point).data;b=e.dA[C],E=e.dP[C],y=e.dT[C]}else{var k=r([w.point.x,w.point.y,w.point.z]);b=k[0],E=k[1],y=k[2],u&&g%100===0&&console.log(b,E,y)}b<y&&b<E?o+=w.sign:y<E?c+=w.sign:i+=w.sign}var O=n.totalVol;return[i/(o+i+c)*O,c/(o+i+c)*O,o/(o+i+c)*O]}},41:function(e,t,n){},42:function(e,t,n){e.exports=n.p+"static/media/processing.529e8cb8.gif"},43:function(e,t,n){"use strict";n.d(t,"b",function(){return o}),n.d(t,"a",function(){return i});var a=n(9);function r(e){for(var t=[],n=[],r=e.split(/[\r\n]+/g),o=r[0].split(/ +/),i=parseInt(o[0]),s=parseInt(o[1]),l=1,u=0;u<i;u++){var c=r[l].split(" ");t.push(new a.d(parseFloat(c[1]),parseFloat(c[2]),parseFloat(c[3]))),l++}for(var d=0;d<s;d++){var h=r[l].split(/ +/);if("tri"!=h[2])throw console.log(r[l],l,o),"UCD has non-triangle face";n.push([parseInt(h[3]),parseInt(h[4]),parseInt(h[5])]),l++}return[t,n]}function o(e,t){for(var n=new a.d(0,0,0),r=0;r<e.length;r++)n.addScaledVector(e[r],1/e.length);for(var o=0,i=0;i<t.length;i++){var s=new a.b,l=t[i];s.set(e[l[0]].x-n.x,e[l[0]].y-n.y,e[l[0]].z-n.z,e[l[1]].x-n.x,e[l[1]].y-n.y,e[l[1]].z-n.z,e[l[2]].x-n.x,e[l[2]].y-n.y,e[l[2]].z-n.z),o+=s.determinant()/6}return o}function i(e){return function(e){return new Promise(function(t,n){var a=new FileReader;a.onload=function(){t(a.result)},a.readAsText(e)})}(e).then(r)}},51:function(e,t,n){"use strict";(function(e){var a=n(10),r=n(1),o=n(2),i=n(14),s=n(3),l=n(4),u=n(0),c=n.n(u),d=n(67),h=n(52),m=n(59),p=n(43),g=n(29),f=n(61),v=(n(41),function(t){Object(s.a)(u,t);var n=Object(l.a)(u);function u(e){var t;return Object(r.a)(this,u),(t=n.call(this,e)).state={patientsToCompute:new f.a,numberToCompute:1,numberComputed:1,mode:"local"},t.addFiles=t.addFiles.bind(Object(i.a)(t)),t.sendPatientFile=t.sendPatientFile.bind(Object(i.a)(t)),t.sendAllPatients=t.sendAllPatients.bind(Object(i.a)(t)),t.generateAndDownload=t.generateAndDownload.bind(Object(i.a)(t)),t}return Object(o.a)(u,[{key:"addFiles",value:function(e){var t=this.state.patientsToCompute;console.log(e),e.forEach(function(e){return t.addNewFile(e)}),this.setState({patients:t})}},{key:"sendPatientFile",value:function(t){var n=this;if(this.state.patientsToCompute.get(t).keys().length===1+Math.max.apply(Math,Object(a.a)(this.state.patientsToCompute.get(t).keys()))){var r=this.state.patientsToCompute.get(t).get(0).name.split(".").pop();if("docker"!==this.state.mode){var o=this,i=[];return this.state.patientsToCompute.get(t).keys().forEach(function(e){return i.push(n.state.patientsToCompute.get(t).get(e))}),void Promise.all(i.map(p.a)).then(function(e){for(var t=-1,n=1e20,a=1;a<e.length;a++){var r=Object(p.b)(e[a][0],e[a][1]);n>r&&(t=a,n=r)}console.log("iMin",t);var o={};return o.ED=e[0],o.ES=e[t],o}).then(function(e){var n=Object(g.c)(e.ED),a=Object(g.b)(e.ES,n),r=Object(g.a)(n),i=Object(g.a)(a);o.props.addNewResult(t,r,i,n,a,!1);var s=o.state.patientsToCompute;s.removeFile(t),o.setState({patientsToCompute:s,numberComputed:o.state.numberComputed+1})})}console.log("Sending new patient");var s=new Headers,l=new FormData;l.append("pId",t),l.append("format",r),this.state.patientsToCompute.get(t).keys().forEach(function(e){return l.append(e,n.state.patientsToCompute.get(t).get(e))}),fetch("http://localhost:5000/computePartitionSingleIndividual",{method:"POST",headers:s,mode:"cors",body:l}).then(function(n){n.json().then(function(n){var a=e.state.patientsToCompute;a.removeFile(t),e.setState({patientsToCompute:a,numberComputed:e.state.numberComputed+1}),e.props.addNewResult(t,[n.outflowEDV,n.inletEDV,n.apicalEDV],[n.outflowEF,n.inletEF,n.apicalEF],void 0,void 0,!0)})})}else this.setState({numberComputed:this.state.numberComputed+1})}},{key:"sendAllPatients",value:function(){var e=this;this.setState({numberToCompute:this.state.patientsToCompute.length(),numberComputed:0}),this.state.patientsToCompute.keys().forEach(function(t){return e.sendPatientFile(t)})}},{key:"generateAndDownload",value:function(){var e="data:text/csv;charset=utf-8,",t=["pID","outflowEDV","inletEDV","apicalEDV","outflowEF","inletEF","apicalEF"],n=t.join(";");e+=n+"\r\n",this.props.patientsComputed.forEach(function(n,a){for(var r=new Array(t.length),o=1;o<t.length;o++)r[o]=Number(n[o]).toFixed(3);var i=r.join(";");e+=i+"\r\n"});var a=encodeURI(e),r=document.createElement("a");r.setAttribute("href",a),r.setAttribute("download","regionalVolumes.csv"),document.body.appendChild(r),r.click()}},{key:"render",value:function(){var e=this.state.patientsToCompute,t=this.props.patientsComputed,n=100*this.state.numberComputed/this.state.numberToCompute;return c.a.createElement("div",{className:"Computation"},c.a.createElement("aside",null,this.state.numberComputed===this.state.numberToCompute?c.a.createElement("div",null,c.a.createElement(h.a,{onDrop:this.addFiles}),c.a.createElement(d.a,{variant:"dark",onClick:this.sendAllPatients,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"},"Parcellate!  "),c.a.createElement(d.a,{variant:"dark",disabled:this.state.numberComputed!==this.state.numberToCompute,onClick:this.generateAndDownload,class:"bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded"},"Download CSV")):c.a.createElement("div",{class:"container"},c.a.createElement(m.a,{value:n,maxValue:100,minValue:0,text:"".concat(this.state.numberComputed,"/").concat(this.state.numberToCompute)})),c.a.createElement("div",{class:"row"},c.a.createElement("div",{class:"column"},c.a.createElement("h4",null,"Patients to compute "),c.a.createElement("ul",null,e.keys().map(function(t){return c.a.createElement("li",{key:t},c.a.createElement("font",{color:e.get(t).keys().length===1+Math.max.apply(Math,Object(a.a)(e.get(t).keys()))?"black":"red"},t,"  -  ",e.get(t).keys().length," / ",1+Math.max.apply(Math,Object(a.a)(e.get(t).keys()))))}))),c.a.createElement("div",{class:"column"},c.a.createElement("h4",null,"Patients computed "),c.a.createElement("ul",null,t.map(function(e){return c.a.createElement("li",{key:e[0]},c.a.createElement("font",{color:"Black"},e[0]))}))))))}}]),u}(c.a.Component));t.a=v}).call(this,n(40))},52:function(e,t,n){"use strict";var a=n(53),r=n(0),o=n.n(r),i=n(66),s=n(55);function l(){var e=Object(a.a)(["\n  flex: 1;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  padding: 20px;\n  border-width: 2px;\n  border-radius: 2px;\n  border-color: ",";\n  border-style: dashed;\n  background-color: #fafafa;\n  color: #bdbdbd;\n  outline: none;\n  transition: border .24s ease-in-out;\n"]);return l=function(){return e},e}var u=s.a.div(l(),function(e){return function(e){return e.isDragAccept?"#00e676":e.isDragReject?"#ff1744":e.isDragActive?"#2196f3":"#eeeeee"}(e)});t.a=function(e){var t=Object(r.useCallback)(e.onDrop,[]),n=Object(i.a)({onDrop:t,accept:".vtk, .ucd"}),a=n.getRootProps,s=n.getInputProps,l=n.isDragActive,c=n.isDragAccept,d=n.isDragReject;return o.a.createElement("div",{className:"container"},o.a.createElement(u,a({isDragActive:l,isDragAccept:c,isDragReject:d}),o.a.createElement("input",s()),o.a.createElement("p",null,"Drag 'n' drop some VTK files here, or click to select files")))}},61:function(e,t,n){"use strict";n.d(t,"a",function(){return u});var a=n(10),r=n(3),o=n(4),i=n(1),s=n(2),l=function(){function e(){Object(i.a)(this,e),this.data={}}return Object(s.a)(e,[{key:"get",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(void 0===this.data[e]&&null===t)return this.set(e,t()),this.data[e];if(void 0===this.data[e])throw Object.assign(new Error("${k} not in dictionary"),{code:400});return this.data[e]}},{key:"set",value:function(e,t){this.data[e]=t}},{key:"keys",value:function(){return Object.keys(this.data)}},{key:"length",value:function(){return this.keys().length}}]),e}(),u=function(e){Object(r.a)(n,e);var t=Object(o.a)(n);function n(){return Object(i.a)(this,n),t.apply(this,arguments)}return Object(s.a)(n,[{key:"addNewFile",value:function(e){var t=e.name.split("_"),n=t.slice(0,-1).join("_"),a=parseInt(t[t.length-1].split(".")[0]);n in this.data||this.set(n,new l),this.get(n).set(a,e)}},{key:"removeFile",value:function(e){console.log("Removing",e),console.log(this),delete this.data[e]}},{key:"isOK",value:function(){var e=this;return this.keys().every(function(t){return e.get(t).keys()===Math.max.apply(Math,Object(a.a)(e.get(t).keys()))})}}]),n}(l)},68:function(e,t,n){e.exports=n(110)},73:function(e,t,n){e.exports=n.p+"static/media/logo.5d5d9eef.svg"}},[[68,1,2]]]);
//# sourceMappingURL=main.b7006ffa.chunk.js.map